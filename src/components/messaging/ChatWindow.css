.chat-window {
  display: flex;
  flex-direction: column;
  height: 100%;
}
.chat-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem var(--container-pad-x);
  border-bottom: 1px solid #eee;
}
.chat-header .avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
}
.chat-header h3 {
  margin: 0;
}
.chat-header p {
  margin: 0;
  font-size: var(--fs-sm);
  color: #777;
}
.chat-header .owner-badge { margin-left:.5rem; font-size:.7rem; background:#f0f9ff; color:#0369a1; border:1px solid #bae6fd; padding:.1rem .4rem; border-radius:6px; vertical-align: middle; }
.safety-tip {
  background-color: #fffbeb;
  color: #b45309;
  padding: 1rem var(--container-pad-x);
  font-size: 14px;
  border-bottom: 1px solid #eee;
}
.messages-area {
  flex-grow: 1;
  overflow-y: auto;
  padding: 1.5rem var(--container-pad-x);
  display: flex;
  flex-direction: column;
  gap: 1rem;
  /* keep content visible above sticky input + quick replies + mobile bottom nav */
  padding-bottom: 11rem;
}
.load-older-btn {
  align-self: center;
  background: #e9eef5;
  color: #334155;
  border: 1px solid #cbd5e1;
  border-radius: 20px;
  padding: 4px 14px;
  font-size: .7rem;
  cursor: pointer;
}
.load-older-btn:disabled {
  opacity: 0.6;
  cursor: default;
}
.message-bubble-wrapper {
  display: flex;
  max-width: 70%;
}
.message-bubble {
  padding: 0.75rem 1rem;
  border-radius: 18px;
  line-height: 1.5;
}
.message-bubble .attachments { display:flex; flex-direction:column; gap:6px; margin-top:.4rem; }
.message-bubble .attachment-link { color:inherit; text-decoration:underline; word-break: break-all; }
.message-bubble-wrapper.sent {
  align-self: flex-end;
}
.message-bubble-wrapper.sent .message-bubble {
  background-color: var(--color-brand);
  color: var(--blanc);
  border-bottom-right-radius: 4px;
}
.message-bubble-wrapper.received { align-self:flex-start; }
.message-bubble-wrapper.received .message-bubble { background-color:#f1f1f1; border-bottom-left-radius:4px; }
.message-bubble.failed { background: var(--color-bg-danger-soft); border:1px solid var(--color-danger-border); color: var(--color-danger); }
.message-bubble .message-meta { font-size: 10px; opacity: .8; margin-top: 4px; text-align: right; }
.message-bubble .message-meta.left { text-align: left; }
.message-bubble-wrapper .message-bubble.pending::after {
  content: ' â€¦';
  opacity: 0.6;
}
.retry-btn { background:none; border:none; color:var(--color-brand); cursor:pointer; font-size:12px; margin-left:6px; text-decoration:underline; }
.message-input-area {
  position: sticky;
  bottom: 0;
  display: flex;
  align-items: center;
  padding: .75rem var(--container-pad-x);
  border-top: 1px solid #eee;
  gap: .65rem;
  background: #fff;
  z-index: 5;
  padding-bottom: calc(.75rem + env(safe-area-inset-bottom, 0px));
}
.message-input-area input {
  flex-grow: 1;
  border: none;
  background-color: #f1f1f1;
  padding: .6rem .85rem;
  border-radius: 18px;
  font-size: var(--fs-sm);
}
.message-input-area input:focus { outline:2px solid var(--color-focus-ring); }
.attach-icon { font-size:24px; color:#777; }
.send-button { background-color: var(--color-brand); color: var(--blanc); border:none; border-radius:50%; width:38px; height:38px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:18px; }
.pending-files { display:flex; align-items:center; gap:6px; flex-wrap: wrap; }
.pending-file-chip { background:#e9eef5; color:#334155; border:1px solid #cbd5e1; border-radius:12px; padding:2px 8px; font-size:.7rem; max-width:140px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.pending-file-chip.more { background:#0ea5e9; color:#fff; border-color:#0284c7; }
.clear-files { background:none; border:none; color:var(--color-brand); cursor:pointer; font-size:.75rem; text-decoration:underline; }

/* Ensure file ends with newline and no stray syntax issues */

/* New messages chip that appears when scrolled away from latest (top). Place it below header. */
.new-messages-chip { position: sticky; bottom: calc(var(--mobile-bottom-nav-height, 56px) + 64px); display:flex; justify-content:center; pointer-events:none; z-index:4; }
.new-messages-chip button { pointer-events:auto; background:#0ea5e9; color:#fff; border:none; border-radius:999px; padding:.35rem .75rem; font-size:.75rem; box-shadow:0 6px 22px -6px rgba(14,165,233,.55); cursor:pointer; }

/* Date separator between message days */
.date-separator { display:flex; align-items:center; gap:.75rem; color:#64748b; font-size:.75rem; margin: .25rem 0; }
.date-separator::before, .date-separator::after { content:""; height:1px; background:#e2e8f0; flex:1; }
.date-separator span { background:#fff; padding:.1rem .5rem; border:1px solid #e2e8f0; border-radius:999px; }

/* Quick reply chips row */
.quick-replies { display:flex; flex-wrap: wrap; gap:.5rem; padding:.5rem 1rem 0; border-top:1px solid #f0f0f0; }
.quick-reply-chip { background:#eef6ff; color:#075985; border:1px solid #bfdbfe; padding:.25rem .6rem; border-radius:999px; font-size: var(--fs-sm); cursor:pointer; }
.quick-reply-chip:hover { filter:brightness(.95); }

/* Match bottom nav breakpoint and lift input above the nav */
@media (max-width: 900px){
  .safety-tip { display:none; }
  /* Keep the sticky input above the Bottom Nav */
  .message-input-area { padding:.6rem var(--container-pad-x); gap:.5rem; bottom: calc(var(--mobile-bottom-nav-height, 56px) + env(safe-area-inset-bottom, 0px)); }
  .message-input-area input { padding:.55rem .75rem; font-size: var(--fs-xs); }
  .send-button { width:36px; height:36px; font-size:16px; }
  .chat-header { padding:.6rem var(--container-pad-x); }
  .chat-header p { font-size: var(--fs-xs); }
  .chat-window .message-bubble { font-size: var(--fs-sm); }
  .new-messages-chip { bottom: calc(var(--mobile-bottom-nav-height, 56px) + 64px); }
  .quick-reply-chip { font-size: var(--fs-xs); }
}

/* Very small screens use a slightly shorter nav height */
@media (max-width: 420px){
  .message-input-area { bottom: calc(var(--mobile-bottom-nav-height, 54px) + env(safe-area-inset-bottom, 0px)); }
}